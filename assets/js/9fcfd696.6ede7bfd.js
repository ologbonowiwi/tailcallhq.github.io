"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[5091],{5704:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>h,contentTitle:()=>r,default:()=>d,frontMatter:()=>a,metadata:()=>c,toc:()=>o});var s=n(5893),i=n(1151);const a={title:"@cache"},r=void 0,c={id:"operators/cache",title:"@cache",description:"The @cache directive provides a protocol agnostic mechanism for caching the results of fields within a GraphQL schema. Like any other cache implementation, this feature is useful for optimizing performance by reducing the need to fetch data that doesn't change frequently.",source:"@site/docs/operators/cache.md",sourceDirName:"operators",slug:"/operators/cache",permalink:"/docs/operators/cache",draft:!1,unlisted:!1,editUrl:"https://github.com/tailcallhq/tailcallhq.github.io/tree/develop/docs/operators/cache.md",tags:[],version:"current",frontMatter:{title:"@cache"},sidebar:"tutorialSidebar",previous:{title:"@addField",permalink:"/docs/operators/add-field"},next:{title:"@call",permalink:"/docs/operators/call"}},h={},o=[{value:"maxAge",id:"maxage",level:2},{value:"Usage",id:"usage",level:2},{value:"Cache Key",id:"cache-key",level:2}];function l(e){const t={code:"code",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,i.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.strong,{children:"@cache"})," directive provides a protocol agnostic mechanism for caching the results of fields within a GraphQL schema. Like any other cache implementation, this feature is useful for optimizing performance by reducing the need to fetch data that doesn't change frequently."]}),"\n",(0,s.jsx)(t.h2,{id:"maxage",children:"maxAge"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-graphql",children:"@cache(maxAge: Int)\n"})}),"\n",(0,s.jsx)(t.p,{children:"This parameter is a non-zero unsigned integer specifying the duration, in milliseconds, that retains the cached value."}),"\n",(0,s.jsx)(t.h2,{id:"usage",children:"Usage"}),"\n",(0,s.jsx)(t.p,{children:"Consider the following GraphQL schema example:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-graphql",children:'type Query {\n  posts: [Post] @http(path: "/posts")\n}\n\ntype Post {\n  id: Int\n  title: String\n  userId: Int @cache(maxAge: 100)\n  user: User\n    @http(path: "/user/{{value.userId}}")\n    @cache(maxAge: 200)\n}\n\ntype User {\n  id: Int\n  name: String\n  email: String\n}\n'})}),"\n",(0,s.jsxs)(t.p,{children:["In this configuration, the system caches the result of the ",(0,s.jsx)(t.code,{children:"user"})," field due to its association with an HTTP resolver. But it does not cache the values of ",(0,s.jsx)(t.code,{children:"userId"})," and ",(0,s.jsx)(t.code,{children:"title"})," because they lack individual resolvers; the resolver for the ",(0,s.jsx)(t.code,{children:"posts"})," field retrieves their values, employing the ",(0,s.jsx)(t.code,{children:'@http(path: "/posts")'})," directive."]}),"\n",(0,s.jsxs)(t.p,{children:["Applying the ",(0,s.jsx)(t.code,{children:"@cache"})," directive at the type level affects all fields within that type. For example:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-graphql",children:'type Query {\n  posts: [Post] @http(path: "/posts")\n}\n\ntype Post @cache(maxAge: 100) {\n  id: Int\n  title: String\n  userId: Int\n  user: User @http(path: "/user/{{value.userId}}")\n}\n\ntype User {\n  id: Int\n  name: String\n  email: String\n}\n'})}),"\n",(0,s.jsxs)(t.p,{children:["You can simplify this configuration to show that applying the ",(0,s.jsx)(t.code,{children:"@cache"})," directive to a type means every field within that type inherits it:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-graphql",children:'type Query {\n  posts: [Post] @http(path: "/posts")\n}\n\ntype Post {\n  id: Int @cache(maxAge: 100)\n  title: String @cache(maxAge: 100)\n  userId: Int @cache(maxAge: 100)\n  user: User\n    @http(path: "/user/{{value.userId}}")\n    @cache(maxAge: 100)\n}\n\ntype User {\n  id: Int\n  name: String\n  email: String\n}\n'})}),"\n",(0,s.jsxs)(t.p,{children:["Since the ",(0,s.jsx)(t.code,{children:"@cache"})," directive does not affect fields without resolvers, the effective configuration can be further reduced as follows:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-graphql",children:'type Query {\n  posts: [Post] @http(path: "/posts")\n}\n\ntype Post {\n  id: Int\n  title: String\n  userId: Int\n  user: User\n    @http(path: "/user/{{value.userId}}")\n    @cache(maxAge: 100)\n}\n\ntype User {\n  id: Int\n  name: String\n  email: String\n}\n'})}),"\n",(0,s.jsxs)(t.p,{children:["When applying the ",(0,s.jsx)(t.code,{children:"@cache"})," directive both at the type level and on individual fields within that type, the field-level directive takes precedence:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-graphql",children:'type Query {\n  posts: [Post] @http(path: "/posts")\n}\n\ntype Post @cache(maxAge: 200) {\n  id: Int\n  title: String\n  userId: Int\n  user: User\n    @http(path: "/user/{{value.userId}}")\n    @cache(maxAge: 100)\n}\n\ntype User {\n  id: Int\n  name: String\n  email: String\n}\n'})}),"\n",(0,s.jsxs)(t.p,{children:["Thus, in the configuration above, while all fields inherit the ",(0,s.jsx)(t.code,{children:"@cache(maxAge: 200)"})," directive at the type level, the ",(0,s.jsx)(t.code,{children:"user"})," field's explicit ",(0,s.jsx)(t.code,{children:"@cache(maxAge: 100)"})," directive takes precedence."]}),"\n",(0,s.jsx)(t.h2,{id:"cache-key",children:"Cache Key"}),"\n",(0,s.jsx)(t.p,{children:"The caching mechanism generates a hash based on information related to the applied query to serve as the cache key for the corresponding value."}),"\n",(0,s.jsxs)(t.p,{children:["For instance, the system caches the ",(0,s.jsx)(t.code,{children:"user"})," field in the following configuration, using the hash of the interpolated string ",(0,s.jsx)(t.code,{children:'"/user/{{value.userId}}"'})," as the cache key. For example, if ",(0,s.jsx)(t.code,{children:"Post.userId"})," equals ",(0,s.jsx)(t.code,{children:"1"}),", the system generates the cache key by hashing the string ",(0,s.jsx)(t.code,{children:'"/users/1"'}),"."]})]})}function d(e={}){const{wrapper:t}={...(0,i.a)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},1151:(e,t,n)=>{n.d(t,{Z:()=>c,a:()=>r});var s=n(7294);const i={},a=s.createContext(i);function r(e){const t=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(a.Provider,{value:t},e.children)}}}]);